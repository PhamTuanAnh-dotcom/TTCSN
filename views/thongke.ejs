<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™ doanh thu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 200px;
            height: 100vh;
            background: #2c3e50;
            color: white;
            border-right: 1px solid #ccc;
            padding: 15px;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: 10px;
            text-decoration: none;
            color: white;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .sidebar a:hover, .sidebar .active {
            background: #34495e;
        }
        .sidebar .logout {
           text-align: center;
           padding: 10px;
           border-top: 1px solid #47525d;
        }

        /* Content */
        .content {
            margin-left: 220px;
            padding: 20px;
        }

        .title {
            text-align: center;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        select {
            padding: 5px 10px;
            font-size: 16px;
        }

        .stat-area {
            display: flex;
            justify-content: space-between;
        }

        .chart-box {
            width: 58%;
            height: 360px;
            border: 1px solid #ccc;
            padding: 15px;
        }

        .popular-box {
            width: 38%;
            height: 360px;
            border: 1px solid #ccc;
            padding: 15px;
        }

        table {
            width: 100%;
            margin-top: 12px;
        }

        table th, table td {
            padding: 6px;
            border-bottom: 1px solid #ccc;
        }

        .bottom-text {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }

    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <a href="/home_ql">üè† Trang ch·ªß</a>
        <a href="/staff/dsnhanvien">‚öôÔ∏è Qu·∫£n l√≠ nh√¢n vi√™n</a>
        <a href="/menu/dsmonan">üçΩÔ∏è Qu·∫£n l√≠ th·ª±c ƒë∆°n</a>
        <a class="active" href="/thongke">üìä Th·ªëng k√™</a>
        <a href="/dinhluong">üßÆ Qu·∫£n l√≠ ƒë·ªãnh l∆∞·ª£ng</a>
        <div class="logout">
            <a href="/auth/logout" class="logout-btn" style="color:#f39c12; text-decoration:none;">üö™ ƒêƒÉng xu·∫•t</a>
        </div>
    </div>
    
    <!-- N·ªôi dung -->
    <div class="content">

        <div class="title">NH√Ä H√ÄNG SI√äU C·∫§P VIP PRO</div>

        <!-- Dropdown ch·ªçn th√°ng -->
        <div class="top-row">
            <select id="monthSelect" onchange="onChangeMonth()">
                <option disabled>Th·ªùi gian (Th√°ng)</option>

                <% monthList.forEach(m => { %>
                    <option value="<%= m.thang %>-<%= m.nam %>"
                        <%= (m.thang == selectedMonth && m.nam == selectedYear) ? "selected" : "" %>>
                        Th√°ng <%= m.thang %> - <%= m.nam %>
                    </option>
                <% }) %>
            </select>
        </div>

        <!-- Khu v·ª±c bi·ªÉu ƒë·ªì + m√≥n th·ªãnh h√†nh -->
        <div class="stat-area">

            <div class="chart-box">
                <canvas id="chartDoanhThu"></canvas>
            </div>

            <div class="popular-box">
                <h3>Nh·ªØng m√≥n th·ªãnh h√†nh</h3>
                <table>
                    <tr>
                        <th>T√™n</th>
                        <th>S·ªë l·∫ßn g·ªçi</th>
                    </tr>
                    <% popularFoods.forEach(p => { %>
                        <tr>
                            <td><%= p.TenMon %></td>
                            <td><%= p.SoLanGoi %></td>
                        </tr>
                    <% }) %>
                </table>
            </div>

        </div>

        <div class="bottom-text">
            T·ªïng doanh thu th√°ng: <span id="tongDoanhThu"><%= tongDoanhThu %></span> tri·ªáu ƒë·ªìng
        </div>

    </div>

    <!-- JS x·ª≠ l√Ω bi·ªÉu ƒë·ªì -->
    <script>
    const ctx = document.getElementById('chartDoanhThu');
    const values = <%- JSON.stringify(values.map(Number)) %>;
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: <%- JSON.stringify(labels) %>,
            datasets: [{
                label: 'Doanh thu (tri·ªáu ƒë·ªìng)',
                data: <%- JSON.stringify(values.map(v => Number(v))) %>,  
                borderWidth: 3,
                borderColor: "blue",
                backgroundColor: "rgba(0,123,255,0.3)",
                tension: 0.3
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    suggestedMax: Math.max(...values.map(v => Number(v)), 0.001) * 1.3,
                    title: { display: true, text: 'Doanh thu (tri·ªáu)' }
                },
                x: {
                    title: { display: true, text: 'C√°c tu·∫ßn trong th√°ng' }
                }
            }
        }
    });
</script>
    <script>
        function onChangeMonth() {
            const select = document.getElementById('monthSelect');
            const value = select.value;  // "thang-nam"
            window.location.href = `/thongke?month=${value}`;
        }
    </script>
</body>
</html>
